# Decimal512 æµ‹è¯• Demo

è¿™æ˜¯ä¸€ä¸ªç”¨äºéªŒè¯ ClickHouse Decimal512 åŠŸèƒ½çš„ç‹¬ç«‹æµ‹è¯•ç¨‹åºã€‚

## å‰ç½®æ¡ä»¶

1. **ClickHouse ç‰ˆæœ¬**: 24.8+ ï¼ˆæ”¯æŒ Decimal512ï¼‰
2. **Go ç‰ˆæœ¬**: 1.21+
3. **ClickHouse æœåŠ¡**: æœ¬åœ°æˆ–è¿œç¨‹å¯è®¿é—®çš„ ClickHouse å®ä¾‹

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®è¿æ¥ä¿¡æ¯

ç¼–è¾‘ `main.go` æ–‡ä»¶ï¼Œä¿®æ”¹è¿æ¥å‚æ•°ï¼š

```go
conn, err := clickhouse.Open(&clickhouse.Options{
    Addr: []string{"127.0.0.1:9000"}, // ä¿®æ”¹ä¸ºä½ çš„ ClickHouse åœ°å€
    Auth: clickhouse.Auth{
        Database: "default", // ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“
        Username: "default", // ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
        Password: "",        // ä¿®æ”¹ä¸ºä½ çš„å¯†ç 
    },
    // ... å…¶ä»–é…ç½®
})
```

### 2. è¿è¡Œæµ‹è¯•

```bash
cd /root/clickhouse-go/examples/decimal512_demo
go run main.go
```

## æµ‹è¯•å†…å®¹

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

1. **è¿æ¥æµ‹è¯•**: éªŒè¯ä¸ ClickHouse çš„è¿æ¥
2. **ç‰ˆæœ¬æ£€æŸ¥**: ç¡®è®¤ ClickHouse ç‰ˆæœ¬
3. **è¡¨åˆ›å»º**: åˆ›å»ºåŒ…å«å¤šç§ç²¾åº¦ Decimal512 åˆ—çš„æµ‹è¯•è¡¨
4. **æ•°æ®æ’å…¥**: æ’å…¥ä¸åŒç²¾åº¦çš„æµ‹è¯•æ•°æ®ï¼ˆ77-154 ä½ï¼‰
5. **æ•°æ®æŸ¥è¯¢**: è¯»å–å¹¶éªŒè¯æ•°æ®å®Œæ•´æ€§
6. **è´Ÿæ•°æµ‹è¯•**: éªŒè¯è´Ÿæ•°çš„æ­£ç¡®å¤„ç†

### å¤æ‚ç±»å‹æµ‹è¯•

- **Nullable(Decimal512)**: æµ‹è¯• NULL å€¼å¤„ç†
- **Array(Decimal512)**: æµ‹è¯•æ•°ç»„ç±»å‹
- **Map(String, Decimal512)**: æµ‹è¯• Map ç±»å‹

## é¢„æœŸè¾“å‡º

```
âœ… è¿æ¥æˆåŠŸï¼
ğŸ“Š ClickHouse ç‰ˆæœ¬: 24.8.x

ğŸ”¨ åˆ›å»ºæµ‹è¯•è¡¨: test_decimal512_demo
âœ… è¡¨åˆ›å»ºæˆåŠŸ

ğŸ“ æ’å…¥æµ‹è¯•æ•°æ®...
âœ… æˆåŠŸæ’å…¥ 3 æ¡æ•°æ®

ğŸ” æŸ¥è¯¢æ•°æ®å¹¶éªŒè¯...

======================================================================================================================================================
ID    | åç§°                   | å°ç²¾åº¦(80ä½)                          | ä¸­ç²¾åº¦(120ä½)                                                      | å¤§ç²¾åº¦(154ä½)
======================================================================================================================================================
1     | å°ç²¾åº¦æµ‹è¯•              | 12345678901234567890.1234567890      | 11111111111111111111111111111111111111111111111111.11111...      | 12345678901234567890123456789012345678901234567890123456...
2     | ä¸­ç²¾åº¦æµ‹è¯•              | 98765432109876543210.9876543210      | 22222222222222222222222222222222222222222222222222.22222...      | 99999999999999999999999999999999999999999999999999999999...
3     | è´Ÿæ•°æµ‹è¯•               | -55555555555555555555.5555555555     | -33333333333333333333333333333333333333333333333333.3333...      | -77777777777777777777777777777777777777777777777777777777...
======================================================================================================================================================

âœ… æˆåŠŸè¯»å– 3 æ¡æ•°æ®

ğŸ§ª æµ‹è¯•å¤æ‚ç±»å‹æ”¯æŒ...

  å¤æ‚ç±»å‹æµ‹è¯•ç»“æœ:
  - ID 1: Nullable=æœ‰å€¼, Arrayé•¿åº¦=2, Mapé”®æ•°=2
  - ID 2: Nullable=NULL, Arrayé•¿åº¦=1, Mapé”®æ•°=1
  âœ… å¤æ‚ç±»å‹æµ‹è¯•é€šè¿‡

ğŸ§¹ æ¸…ç†æµ‹è¯•è¡¨...
âœ… æ¸…ç†å®Œæˆ

ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼Decimal512 åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼
```

## æµ‹è¯•çš„ç²¾åº¦èŒƒå›´

| åˆ—å | ç²¾åº¦ | Scale | ç¤ºä¾‹å€¼é•¿åº¦ |
|------|------|-------|-----------|
| amount_small | Decimal(80, 10) | 10 | 70 ä½æ•´æ•° + 10 ä½å°æ•° |
| amount_medium | Decimal(120, 25) | 25 | 95 ä½æ•´æ•° + 25 ä½å°æ•° |
| amount_large | Decimal(154, 50) | 50 | 104 ä½æ•´æ•° + 50 ä½å°æ•° |

## å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥

**é”™è¯¯**: `è¿æ¥å¤±è´¥: dial tcp 127.0.0.1:9000: connect: connection refused`

**è§£å†³**:
- æ£€æŸ¥ ClickHouse æœåŠ¡æ˜¯å¦è¿è¡Œ
- ç¡®è®¤ç«¯å£å·æ­£ç¡®ï¼ˆNative åè®®é»˜è®¤ 9000ï¼‰
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. ç‰ˆæœ¬ä¸æ”¯æŒ

**é”™è¯¯**: è¡¨åˆ›å»ºå¤±è´¥æˆ–ç²¾åº¦è¶…å‡ºèŒƒå›´

**è§£å†³**:
- ç¡®ä¿ ClickHouse ç‰ˆæœ¬ >= 24.8
- è¿è¡Œ `clickhouse-client --version` æ£€æŸ¥ç‰ˆæœ¬

### 3. æƒé™é”™è¯¯

**é”™è¯¯**: `Code: 497. DB::Exception: default: Authentication failed`

**è§£å†³**:
- æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç 
- ç¡®ä¿ç”¨æˆ·æœ‰åˆ›å»ºè¡¨çš„æƒé™
- å¦‚æœä½¿ç”¨é default æ•°æ®åº“ï¼Œç¡®ä¿æ•°æ®åº“å­˜åœ¨

### 4. è°ƒè¯•æ¨¡å¼

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

```go
conn, err := clickhouse.Open(&clickhouse.Options{
    // ...
    Debug: true,  // å¼€å¯è°ƒè¯•
    Debugf: func(format string, v ...any) {
        fmt.Printf("[DEBUG] "+format+"\n", v...)
    },
})
```

## è‡ªå®šä¹‰æµ‹è¯•

### ä¿®æ”¹æµ‹è¯•æ•°æ®

ç¼–è¾‘ `testData` å˜é‡ï¼Œæ·»åŠ ä½ è‡ªå·±çš„æµ‹è¯•æ•°æ®ï¼š

```go
testData := []struct {
    id          uint32
    name        string
    amountSmall string
    amountMed   string
    amountLarge string
}{
    {
        id:          1,
        name:        "ä½ çš„æµ‹è¯•åç§°",
        amountSmall: "ä½ çš„æ•°å€¼...",
        amountMed:   "ä½ çš„æ•°å€¼...",
        amountLarge: "ä½ çš„æ•°å€¼...",
    },
    // ... æ›´å¤šæµ‹è¯•æ•°æ®
}
```

### ä¿®æ”¹è¡¨ç»“æ„

æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹ DDLï¼š

```go
createSQL := fmt.Sprintf(`
    CREATE TABLE %s (
        id UInt32,
        name String,
        your_column Decimal(100, 30),  // è‡ªå®šä¹‰åˆ—
        // ... æ›´å¤šåˆ—
    ) ENGINE = MergeTree()
    ORDER BY id
`, tableName)
```

## æ€§èƒ½æµ‹è¯•

å¦‚æœéœ€è¦æµ‹è¯•å¤§æ‰¹é‡æ•°æ®æ€§èƒ½ï¼Œå¯ä»¥ä¿®æ”¹ä»£ç ï¼š

```go
// æ’å…¥ 10000 æ¡æ•°æ®
for i := 0; i < 10000; i++ {
    batch.Append(
        uint32(i),
        fmt.Sprintf("test-%d", i),
        decimal.RequireFromString("123456789.123456789"),
        // ...
    )
}
```

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥ ClickHouse æ—¥å¿—: `/var/log/clickhouse-server/clickhouse-server.log`
2. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£: `/root/clickhouse-go/docs/`
3. å‚è€ƒéªŒè¯æŠ¥å‘Š: `/root/clickhouse-go/docs/2025_1026_03_decimal512_verification.md`

## ç›¸å…³é“¾æ¥

- [ClickHouse Decimal512 æ–‡æ¡£](https://clickhouse.com/docs/en/sql-reference/data-types/decimal)
- [shopspring/decimal æ–‡æ¡£](https://github.com/shopspring/decimal)
- [clickhouse-go æ–‡æ¡£](https://github.com/ClickHouse/clickhouse-go)

